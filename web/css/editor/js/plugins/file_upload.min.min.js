/*!
 * froala_editor v1.2.8 (https://www.froala.com/wysiwyg-editor)
 * License https://www.froala.com/wysiwyg-editor/terms
 * Copyright 2014-2015 Froala Labs
 */
!function(b){b.Editable.commands=b.extend(b.Editable.commands,{uploadFile:{title:"Upload File",icon:"fa fa-paperclip",callback:function(){this.insertFile()},undo:!1}}),b.Editable.DEFAULTS=b.extend(b.Editable.DEFAULTS,{allowedFileTypes:["*"],fileDeleteUrl:null,fileDeleteParams:{},fileUploadParams:{},fileUploadURL:"http://i.froala.com/upload",fileUploadParam:"file",maxFileSize:10485760,useFileName:!0}),b.Editable.prototype.showFileWrapper=function(){this.$file_wrapper&&this.$file_wrapper.show()},b.Editable.prototype.hideFileWrapper=function(){this.$file_wrapper&&(this.$file_wrapper.hide(),this.$file_wrapper.find("input").blur())},b.Editable.prototype.showFileUpload=function(){this.hidePopups(),this.showFileWrapper()},b.Editable.prototype.insertFile=function(){this.closeImageMode(),this.imageMode=!1,this.showFileUpload(),this.saveSelectionByMarkers(),this.options.inlineMode||this.positionPopup("uploadFile")},b.Editable.prototype.fileUploadHTML=function(){var a='<div class="froala-popup froala-file-popup" style="display: none;"><h4><span data-text="true">Upload file</span><i title="Cancel" class="fa fa-times" id="f-file-close-'+this._id+'"></i></h4>';return a+='<div id="f-file-list-'+this._id+'">',a+='<div class="f-popup-line drop-upload">',a+='<div class="f-upload" id="f-file-upload-div-'+this._id+'"><strong data-text="true">Drop File</strong><br>(<span data-text="true">or click</span>)<form target="file-frame-'+this._id+'" enctype="multipart/form-data" encoding="multipart/form-data" action="'+this.options.fileUploadURL+'" method="post" id="f-file-form-'+this._id+'"><input id="f-file-upload-'+this._id+'" type="file" name="'+this.options.fileUploadParam+'" accept="/*"></form></div>',this.browser.msie&&b.Editable.getIEversion()<=9&&(a+='<iframe id="file-frame-'+this._id+'" name="file-frame-'+this._id+'" src="javascript:false;" style="width:0; height:0; border:0px solid #FFF; position: fixed; z-index: -1;" data-loaded="true"></iframe>'),a+="</div>",a+="</div>",a+='<p class="f-progress" id="f-file-progress-'+this._id+'"><span></span></p>',a+="</div>"},b.Editable.prototype.buildFileDrag=function(){var a=this;a.$file_wrapper.on("dragover","#f-file-upload-div-"+this._id,function(){return b(this).addClass("f-hover"),!1}),a.$file_wrapper.on("dragend","#f-file-upload-div-"+this._id,function(){return b(this).removeClass("f-hover"),!1}),a.$file_wrapper.on("drop","#f-file-upload-div-"+this._id,function(d){d.preventDefault(),d.stopPropagation(),b(this).removeClass("f-hover"),a.uploadFile(d.originalEvent.dataTransfer.files)}),a.$element.on("drop",function(f){var e=f.originalEvent.dataTransfer.files;if(0===b(".froala-element img.fr-image-move").length&&f.originalEvent.dataTransfer&&e&&e.length){if(a.isDisabled){return !1}a.options.allowedImageTypes.indexOf(e[0].type.replace(/image\//g,""))<0&&(a.closeImageMode(),a.hide(),a.imageMode=!1,a.initialized||(a.$element.unbind("mousedown.element"),a.lateInit()),a.insertMarkersAtPoint(f.originalEvent),a.showByCoordinates(f.originalEvent.pageX,f.originalEvent.pageY),a.uploadFile(e),f.preventDefault(),f.stopPropagation())}})},b.Editable.prototype.buildFileUpload=function(){this.$file_wrapper=b(this.fileUploadHTML()),this.$popup_editor.append(this.$file_wrapper),this.buildFileDrag();var a=this;if(this.$file_wrapper.on("mouseup touchend",b.proxy(function(c){this.isResizing()||c.stopPropagation()},this)),this.addListener("hidePopups",b.proxy(function(){this.hideFileWrapper()},this)),this.$file_progress_bar=this.$file_wrapper.find("p#f-file-progress-"+this._id),this.browser.msie&&b.Editable.getIEversion()<=9){var d=this.$file_wrapper.find("iframe").get(0);d.attachEvent?d.attachEvent("onload",function(){a.iFrameLoad()}):d.onload=function(){a.iFrameLoad()}}this.$file_wrapper.on("change",'input[type="file"]',function(){if(void 0!==this.files){a.uploadFile(this.files)}else{var f=b(this).parents("form");f.find('input[type="hidden"]').remove();var e;for(e in a.options.fileUploadParams){f.prepend('<input type="hidden" name="'+e+'" value="'+a.options.fileUploadParams[e]+'" />')}a.$file_wrapper.find("#f-file-list-"+a._id).hide(),a.$file_progress_bar.show(),a.$file_progress_bar.find("span").css("width","100%").text("Please wait!"),a.showFileUpload(),f.submit()}b(this).val("")}),this.$file_wrapper.on(this.mouseup,"#f-file-close-"+this._id,b.proxy(function(c){c.stopPropagation(),c.preventDefault(),this.$bttn_wrapper.show(),this.hideFileWrapper(),this.restoreSelection(),this.focus(),this.hide()},this)),this.$file_wrapper.on("click",function(c){c.stopPropagation()}),this.$file_wrapper.on("click","*",function(c){c.stopPropagation()})},b.Editable.initializers.push(b.Editable.prototype.buildFileUpload),b.Editable.prototype.uploadFile=function(a){if(!this.triggerEvent("beforeFileUpload",[a],!1)){return !1}if(void 0!==a&&a.length>0){var l;if(this.drag_support.formdata&&(l=this.drag_support.formdata?new FormData:null),l){var k;for(k in this.options.fileUploadParams){l.append(k,this.options.fileUploadParams[k])}if(l.append(this.options.fileUploadParam,a[0]),a[0].size>this.options.maxFileSize){return this.throwFileError(5),!1}if(this.options.allowedFileTypes.indexOf(a[0].type)<0&&this.options.allowedFileTypes.indexOf("*")<0){return this.throwFileError(6),!1}}if(l){var j;if(this.options.crossDomain){j=this.createCORSRequest("POST",this.options.fileUploadURL)}else{j=new XMLHttpRequest,j.open("POST",this.options.fileUploadURL);for(var i in this.options.headers){j.setRequestHeader(i,this.options.headers[i])}}var h=a[0].name;j.onload=b.proxy(function(){this.$file_progress_bar.find("span").css("width","100%").text("Please wait!");try{j.status>=200&&j.status<300?this.parseFileResponse(j.responseText,h):this.throwFileError(3)}catch(c){this.throwFileError(4)}},this),j.onerror=b.proxy(function(){this.throwFileError(3)},this),j.upload.onprogress=b.proxy(function(d){if(d.lengthComputable){var c=d.loaded/d.total*100|0;this.$file_progress_bar.find("span").css("width",c+"%")}},this),j.send(l),this.$file_wrapper.find("#f-file-list-"+this._id).hide(),this.$file_progress_bar.show(),this.showFileUpload()}}},b.Editable.prototype.throwFileError=function(d){var c="Unknown file upload error.";1==d?c="Bad link.":2==d?c="No link in upload response.":3==d?c="Error during file upload.":4==d?c="Parsing response failed.":5==d?c="File too large.":6==d?c="Invalid file type.":7==d&&(c="File can be uploaded only to same domain in IE 8 and IE 9."),this.triggerEvent("fileError",[{code:d,message:c}],!1),this.hideFileLoader()},b.Editable.prototype.hideFileLoader=function(){this.$file_progress_bar.hide(),this.$file_progress_bar.find("span").css("width","0%").text(""),this.$file_wrapper.find("#f-file-list-"+this._id).show()},b.Editable.prototype.throwFileErrorWithMessage=function(c){this.triggerEvent("fileError",[{message:c,code:0}],!1),this.hideFileLoader()},b.Editable.prototype.parseFileResponse=function(a,h){try{if(!this.triggerEvent("afterFileUpload",[a],!1)){return !1}var g=b.parseJSON(a);g.link?this.writeFile(g.link,h,a):g.error?this.throwFileErrorWithMessage(g.error):this.throwFileError(2)}catch(f){this.throwFileError(4)}},b.Editable.prototype.writeFile=function(e,d,f){this.restoreSelectionByMarkers(),this.focus(),this.options.useFileName||""===this.text()||(d=this.text()),this.insertHTML('<a class="fr-file" href="'+this.sanitizeURL(e)+'">'+d+"</a>"),this.hide(),this.hideFileLoader(),this.focus(),this.triggerEvent("fileUploaded",[d,e,f])}}(jQuery);