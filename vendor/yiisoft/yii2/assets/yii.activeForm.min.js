(function(f){f.fn.yiiActiveForm=function(s){if(r[s]){return r[s].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof s==="object"||!s){return r.init.apply(this,arguments)}else{f.error("Method "+s+" does not exist on jQuery.yiiActiveForm");return false}}};var c={beforeValidate:"beforeValidate",afterValidate:"afterValidate",beforeValidateAttribute:"beforeValidateAttribute",afterValidateAttribute:"afterValidateAttribute",beforeSubmit:"beforeSubmit",ajaxBeforeSend:"ajaxBeforeSend",ajaxComplete:"ajaxComplete"};var j={encodeErrorSummary:true,errorSummary:".error-summary",validateOnSubmit:true,errorCssClass:"has-error",successCssClass:"has-success",validatingCssClass:"validating",ajaxParam:"ajax",ajaxDataType:"json",validationUrl:undefined,scrollToError:true};var n={id:undefined,name:undefined,container:undefined,input:undefined,error:".help-block",encodeError:true,validateOnChange:true,validateOnBlur:true,validateOnType:false,validationDelay:500,enableAjaxValidation:false,validate:undefined,status:0,cancelled:false,value:undefined};var p;var a=function(s){p=f.Deferred();s.data("yiiSubmitFinalizePromise",p.promise())};var k=function(s){if(p){p.resolve();p=undefined;s.removeData("yiiSubmitFinalizePromise")}};var r={init:function(s,t){return this.each(function(){var u=f(this);if(u.data("yiiActiveForm")){return}var v=f.extend({},j,t||{});if(v.validationUrl===undefined){v.validationUrl=u.attr("action")}f.each(s,function(w){s[w]=f.extend({value:e(u,this)},n,this);m(u,s[w])});u.data("yiiActiveForm",{settings:v,attributes:s,submitting:false,validated:false});u.bind("reset.yiiActiveForm",r.resetForm);if(v.validateOnSubmit){u.on("mouseup.yiiActiveForm keyup.yiiActiveForm",":submit",function(){u.data("yiiActiveForm").submitObject=f(this)});u.on("submit.yiiActiveForm",r.submitForm)}})},add:function(t){var s=f(this);t=f.extend({value:e(s,t)},n,t);s.data("yiiActiveForm").attributes.push(t);m(s,t)},remove:function(w){var t=f(this),s=t.data("yiiActiveForm").attributes,u=-1,v=undefined;f.each(s,function(x){if(s[x]["id"]==w){u=x;v=s[x];return false}});if(u>=0){s.splice(u,1);q(t,v)}return v},validateAttribute:function(t){var s=r.find.call(this,t);if(s!=undefined){d(f(this),s,true)}},find:function(u){var t=f(this).data("yiiActiveForm").attributes,s=undefined;f.each(t,function(v){if(t[v]["id"]==u){s=t[v];return false}});return s},destroy:function(){return this.each(function(){f(this).unbind(".yiiActiveForm");f(this).removeData("yiiActiveForm")})},data:function(){return this.data("yiiActiveForm")},validate:function(){var t=f(this),y=t.data("yiiActiveForm"),s=false,w={},v=o(),x=y.submitting;if(x){var u=f.Event(c.beforeValidate);t.trigger(u,[w,v]);if(u.result===false){y.submitting=false;k(t);return}}f.each(y.attributes,function(){if(!f(this.input).is(":disabled")){this.cancelled=false;if(y.submitting||this.status===2||this.status===3){var A=w[this.id];if(A===undefined){A=[];w[this.id]=A}var z=f.Event(c.beforeValidateAttribute);t.trigger(z,[this,A,v]);if(z.result!==false){if(this.validate){this.validate(this,e(t,this),A,v,t)}if(this.enableAjaxValidation){s=true}}else{this.cancelled=true}}}});f.when.apply(this,v).always(function(){for(var z in w){if(0===w[z].length){delete w[z]}}if(s){var A=y.submitObject,B="&"+y.settings.ajaxParam+"="+t.attr("id");if(A&&A.length&&A.attr("name")){B+="&"+A.attr("name")+"="+A.attr("value")}f.ajax({url:y.settings.validationUrl,type:t.attr("method"),data:t.serialize()+B,dataType:y.settings.ajaxDataType,complete:function(C,D){t.trigger(c.ajaxComplete,[C,D])},beforeSend:function(D,C){t.trigger(c.ajaxBeforeSend,[D,C])},success:function(C){if(C!==null&&typeof C==="object"){f.each(y.attributes,function(){if(!this.enableAjaxValidation||this.cancelled){delete C[this.id]}});l(t,f.extend(w,C),x)}else{l(t,w,x)}},error:function(){y.submitting=false;k(t)}})}else{if(y.submitting){setTimeout(function(){l(t,w,x)},200)}else{l(t,w,x)}}})},submitForm:function(){var s=f(this),u=s.data("yiiActiveForm");if(u.validated){u.submitting=false;var t=f.Event(c.beforeSubmit);s.trigger(t);if(t.result===false){u.validated=false;k(s);return false}g(s);return true}else{a(s);if(u.settings.timer!==undefined){clearTimeout(u.settings.timer)}u.submitting=true;r.validate.call(s);return false}},resetForm:function(){var s=f(this);var t=s.data("yiiActiveForm");setTimeout(function(){f.each(t.attributes,function(){this.value=e(s,this);this.status=0;var u=s.find(this.container);u.removeClass(t.settings.validatingCssClass+" "+t.settings.errorCssClass+" "+t.settings.successCssClass);u.find(this.error).html("")});s.find(t.settings.errorSummary).hide().find("ul").html("")},1)},updateMessages:function(u,t){var s=f(this);var v=s.data("yiiActiveForm");f.each(v.attributes,function(){i(s,this,u)});if(t){b(s,u)}},updateAttribute:function(v,t){var s=r.find.call(this,v);if(s!=undefined){var u={};u[v]=t;i(f(this),s,u)}}};var m=function(s,t){var u=h(s,t);if(t.validateOnChange){u.on("change.yiiActiveForm",function(){d(s,t,false)})}if(t.validateOnBlur){u.on("blur.yiiActiveForm",function(){if(t.status==0||t.status==1){d(s,t,true)}})}if(t.validateOnType){u.on("keyup.yiiActiveForm",function(v){if(f.inArray(v.which,[16,17,18,37,38,39,40])!==-1){return}if(t.value!==e(s,t)){d(s,t,false,t.validationDelay)}})}};var q=function(s,t){h(s,t).off(".yiiActiveForm")};var d=function(s,u,t,w){var v=s.data("yiiActiveForm");if(t){u.status=2}f.each(v.attributes,function(){if(this.value!==e(s,this)){this.status=2;t=true}});if(!t){return}if(v.settings.timer!==undefined){clearTimeout(v.settings.timer)}v.settings.timer=setTimeout(function(){if(v.submitting||s.is(":hidden")){return}f.each(v.attributes,function(){if(this.status===2){this.status=3;s.find(this.container).addClass(v.settings.validatingCssClass)}});r.validate.call(s)},w?w:200)};var o=function(){var s=[];s.add=function(t){this.push(new f.Deferred(t))};return s};var l=function(s,v,x){var w=s.data("yiiActiveForm");if(x){var u=[];f.each(w.attributes,function(){if(!f(this.input).is(":disabled")&&!this.cancelled&&i(s,this,v)){u.push(this)}});s.trigger(c.afterValidate,[v,u]);b(s,v);if(u.length){if(w.settings.scrollToError){var y=s.find(f.map(u,function(z){return z.input}).join(",")).first().closest(":visible").offset().top;var t=f(window).scrollTop();if(y<t||y>t+f(window).height()){f(window).scrollTop(y)}}w.submitting=false}else{w.validated=true;s.submit()}}else{f.each(w.attributes,function(){if(!this.cancelled&&(this.status===2||this.status===3)){i(s,this,v)}})}k(s)};var g=function(s){var u=s.data("yiiActiveForm");var t=u.submitObject||s.find(":submit:first");if(t.length&&t.attr("type")=="submit"&&t.attr("name")){var v=f('input[type="hidden"][name="'+t.attr("name")+'"]',s);if(!v.length){f("<input>").attr({type:"hidden",name:t.attr("name"),value:t.attr("value")}).appendTo(s)}else{v.attr("value",t.attr("value"))}}};var i=function(u,w,v){var x=u.data("yiiActiveForm"),z=h(u,w),t=false;if(!f.isArray(v[w.id])){v[w.id]=[]}u.trigger(c.afterValidateAttribute,[w,v[w.id]]);w.status=1;if(z.length){t=v[w.id].length>0;var y=u.find(w.container);var s=y.find(w.error);if(t){if(w.encodeError){s.text(v[w.id][0])}else{s.html(v[w.id][0])}y.removeClass(x.settings.validatingCssClass+" "+x.settings.successCssClass).addClass(x.settings.errorCssClass)}else{s.empty();y.removeClass(x.settings.validatingCssClass+" "+x.settings.errorCssClass+" ").addClass(x.settings.successCssClass)}w.value=e(u,w)}return t};var b=function(t,v){var w=t.data("yiiActiveForm"),s=t.find(w.settings.errorSummary),u=s.find("ul").empty();if(s.length&&v){f.each(w.attributes,function(){if(f.isArray(v[this.id])&&v[this.id].length){var x=f("<li/>");if(w.settings.encodeErrorSummary){x.text(v[this.id][0])}else{x.html(v[this.id][0])}u.append(x)}});s.toggle(u.find("li").length>0)}};var e=function(t,v){var w=h(t,v);var u=w.attr("type");if(u==="checkbox"||u==="radio"){var s=w.filter(":checked");if(!s.length){s=t.find('input[type=hidden][name="'+w.attr("name")+'"]')}return s.val()}else{return w.val()}};var h=function(s,t){var u=s.find(t.input);if(u.length&&u[0].tagName.toLowerCase()==="div"){return u.find("input")}else{return u}}})(window.jQuery);