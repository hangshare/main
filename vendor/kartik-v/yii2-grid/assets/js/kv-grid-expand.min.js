/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   3.1.0
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
var kvRowNum=0,kvExpandRow;(function(a){kvExpandRow=function(g){var y=g.gridId,H=g.hiddenFromExport,A=g.detailUrl,C=g.onDetailLoaded,u=g.expandIcon,i=g.collapseIcon,l=g.expandTitle,n=g.collapseTitle,I=g.expandAllTitle,p=g.collapseAllTitle,w=g.expandOneOnly,q=g.enableRowClick,D=g.rowClickExcludedTags,k=g.enableCache,x=g.extraData,s=H?g.rowCssClass+" skip-export":g.rowCssClass,b=g.animationDuration,j=a("#"+y),e=j.find(".kv-expand-header-cell.kv-batch-toggle"),F=e.find(".kv-expand-header-icon"),B=g.collapseAll===undefined?false:g.collapseAll,m=g.expandAll===undefined?false:g.expandAll,z=j.find("td .kv-expand-row:not(.kv-state-disabled)"),f=z.length,o="kv-expand-detail-loading",J=function(){var K=j.find(".kv-expand-icon:first").closest("tr"),L=0;if(!K.length){return 0}K=K.clone();K.find(".kv-expand-row").remove();K.find("td").each(function(){if(a(this).css("display")!=="none"){L++}});return L},t=J(),c=function(K){return K.hasClass("kv-state-collapsed")&&!K.hasClass("kv-state-disabled")},d=function(K){return K.hasClass("kv-state-expanded")&&!K.hasClass("kv-state-disabled")},v=function(L,K){if(L.length){L.removeClass(K).addClass(K)}},E=function(K){K.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},G=function(K){K.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},h=function(K){v(K,o)},r=function(L){if(!L.length){return}var K=isNaN(b)?1000:b+200;setTimeout(function(){L.removeClass(o)},K)};if(x.length===0){x={}}if(z.length===0){v(e,"kv-state-disabled");return}z.each(function(){var X=a(this),P,Q,R=X.find(".kv-expand-icon"),S=X.closest("tr"),U=X.closest(".kv-expand-icon-cell"),W=X.find(".kv-expand-detail"),L=X.find(".kv-expanded-row"),M=L.data("key"),O=L.data("index");if(!c(R)&&!d(R)){return true}if(L.length===0){M=S.data("key");P=S.next('tr.kv-expand-detail-row[data-key="'+M+'"]');L=P.find(".kv-expanded-row")}var V=function(Z){var aa=a.extend({expandRowKey:M,expandRowInd:O},x),Y=k?L.html().length===0:true;h(U);if(A.length>0&&Y){j.trigger("kvexprow.beforeLoad",[O,M,x]);L.load(A,aa,function(){r(U);if(typeof C==="function"){C()}Z();j.trigger("kvexprow.loaded",[O,M,x])});return}else{r(U)}Z()},N=function(Y){j.find('tr[data-index="'+O+'"]').remove();L.hide();S.after(L);var Z='<tr class="kv-expand-detail-row '+s+'" data-key="'+M+'" data-index="'+O+'">';L.wrap('<td colspan="'+t+'">').parent().wrap(Z);R.html(i);U.attr("title",n);if(Y){L.slideDown(b,function(){G(R);L.show()})}else{L.show();G(R)}if(A.length===0){r(U)}},T=function(){h(U);W.html("");R.html(u);U.attr("title",l);Q=L.closest(".kv-expand-detail-row");L.slideUp(b,function(){L.unwrap().unwrap();L.appendTo(W);E(R)});r(U)},K=function(){var Z,Y,aa=false,ab=false;if(U.hasClass(o)){return}if(d(R)){Y=w&&!B;if(Y){Z=a.extend({},g,{collapseAll:true});z.each(function(){if(a(this).closest(".kv-expand-icon-cell").hasClass(o)){ab=true;return}});if(ab){return}kvExpandRow(Z);aa=true}V(function(){N(true)});if(!Y||aa){j.trigger("kvexprow.toggle",[O,M,x,true]);R.focus()}return}if(c(R)){T();j.trigger("kvexprow.toggle",[O,M,x,false]);R.focus()}};if(m){if(d(R)){V(function(){N(true);kvRowNum++;if(kvRowNum>=f){r(e);F.focus()}})}if(kvRowNum>=f){r(e);F.focus()}return true}if(B){if(c(R)){T();kvRowNum++;if(kvRowNum>=f){r(e);F.focus()}}if(kvRowNum>=f){r(e);F.focus()}return true}if(c(R)){if(A){V(function(){N(false)})}else{N(false)}}U.off("click").on("click",function(){K(U)});S.off("click").on("click",function(Z){var aa=Z.target,Y=a(aa).length&&a(aa).hasClass("kv-disable-click")||a.inArray(aa.nodeName,D)!==-1;if(q&&!Y){K(U)}})});if(!e.length){return}e.off().on("click",function(){if(e.hasClass(o)||z.length===0){return}var L=d(F),K=c(F),M=a.extend({},g,{expandAll:K,collapseAll:L});h(e);if(K){kvRowNum=z.find(".kv-state-collapsed").length;E(F);F.html(i);e.attr("title",p);j.trigger("kvexprow.toggleAll",[x,false])}else{if(L){kvRowNum=z.find(".kv-state-expanded").length;G(F);F.html(u);e.attr("title",I);j.trigger("kvexprow.toggleAll",[x,true])}}kvExpandRow(M)})}})(window.jQuery);