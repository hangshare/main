/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   3.1.0
 *
 * Grid Export Validation Module for Yii's Gridview. Supports export of
 * grid data as CSV, HTML, or Excel.
 *
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(f){var a,h,d,c,e,g,b="urn:schemas-microsoft-com:office:";a=function(i,k,j){return i.split(k).join(j)};h=function(j,i){return j===null||j===undefined||j.length===0||(i&&f.trim(j)==="")};d=function(k,j,i,l){var o=(screen.width/2)-(i/2),n=60,m=window.open("",j,"",true);m.close();return window.open(k,j,"toolbar=no, location=no, directories=no, status=yes, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+i+", height="+l+", top="+n+", left="+o)};c=function(i){return i.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")};e={html:'<!DOCTYPE html><meta http-equiv="Content-Type" content="text/html;charset={encoding}"/><meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1"/>{css}<style>.kv-wrap{padding:20px;}.kv-align-center{text-align:center;}.kv-align-left{text-align:left;}.kv-align-right{text-align:right;}.kv-align-top{vertical-align:top!important;}.kv-align-bottom{vertical-align:bottom!important;}.kv-align-middle{vertical-align:middle!important;}.kv-page-summary{border-top:4px double #ddd;font-weight: bold;}.kv-table-footer{border-top:4px double #ddd;font-weight: bold;}.kv-table-caption{font-size:1.5em;padding:8px;border:1px solid #ddd;border-bottom:none;}</style><body class="kv-wrap">{data}</body>',pdf:"{before}\n{data}\n{after}",excel:'<html xmlns:o="'+b+'office" xmlns:x="'+b+'excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html;charset={encoding}"/>{css}<!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body>{data}</body></html>',popup:'<html style="display:table;width:100%;height:100%;"><title>Grid Export - &copy; Krajee</title><body style="display:table-cell;font-family:Helvetica,Arial,sans-serif;color:#888;font-weight:bold;line-height:1.4em;text-align:center;vertical-align:middle;width:100%;height:100%;padding:0 10px;">{msg}</body></html>'};g=function(l,k){var i=this,j=k.gridOpts,m=k.genOpts;i.$element=f(l);i.$grid=f("#"+j.gridId);i.messages=j.messages;i.target=j.target;i.exportConversions=j.exportConversions;i.showConfirmAlert=j.showConfirmAlert;i.filename=m.filename;i.showHeader=m.showHeader;i.showFooter=m.showFooter;i.showPageSummary=m.showPageSummary;i.$table=i.$grid.find(".kv-grid-table:first");i.$form=i.$grid.find("form.kv-export-form");i.encoding=i.$form.find('[name="export_encoding"]').val();i.columns=i.showHeader?"td,th":"td";i.alertMsg=k.alertMsg;i.config=k.config;i.popup="";i.listen()};g.prototype={constructor:g,getArray:function(l){var i=this,j=i.clean(l),k=[],m={};if(i.config.colHeads!==undefined&&i.config.colHeads.length>0){k=i.config.colHeads}else{j.find("thead tr th").each(function(o){var p=f(this).text().trim(),n=c(p);k[o]=(!i.config.slugColHeads||h(n))?"col_"+o:n})}j.find('tbody tr:has("td")').each(function(n){m[n]={};f(this).children("td").each(function(p){var o=k[p];m[n][o]=f(this).text().trim()})});return m},notify:function(n){var i=this;if(!i.showConfirmAlert){n.preventDefault();return true}var m=i.messages,l=h(i.alertMsg)?"":i.alertMsg,k=h(m.allowPopups)?"":m.allowPopups,j=h(m.confirmDownload)?"":m.confirmDownload,o="";if(l.length&&k.length){o=l+"\n\n"+k}else{if(!l.length&&k.length){o=k}else{o=(l.length&&!k.length)?l:""}}if(j.length){o=o+"\n\n"+j}n.preventDefault();if(h(o)){return true}return i.kvConfirm(o)},kvConfirm:function(j){try{return window.confirm(j)}catch(i){return true}},setPopupAlert:function(l){var i=this;if(i.popup.document===undefined){return}if(arguments.length&&arguments[1]){var j=i.popup.document.getElementsByTagName("body");setTimeout(function(){j[0].innerHTML=l},4000)}else{var k=e.popup.replace("{msg}",l);i.popup.document.write(k)}},listenClick:function(k){var j=this,i=arguments.length>1?arguments[1]:"";j.$element.on("click",function(l){if(!j.notify(l)){return}if(!h(i)){j[k](i)}else{j[k]()}l.preventDefault()})},listen:function(){var i=this;if(i.target==="_popup"){i.$form.on("submit",function(){setTimeout(function(){i.setPopupAlert(i.messages.downloadComplete,true)},1000)})}if(i.$element.hasClass("export-csv")){i.listenClick("exportTEXT","csv")}if(i.$element.hasClass("export-txt")){i.listenClick("exportTEXT","txt")}if(i.$element.hasClass("export-html")){i.listenClick("exportHTML")}if(i.$element.hasClass("export-xls")){i.listenClick("exportEXCEL")}if(i.$element.hasClass("export-json")){i.listenClick("exportJSON")}if(i.$element.hasClass("export-pdf")){i.listenClick("exportPDF")}},clean:function(k){var i=this,j=i.$table.clone();j.find("tr.filters").remove();j.find("th").removeAttr("rowspan");j.find("th").find("a").each(function(){f(this).contents().unwrap()});j.find("input").remove();if(!i.showHeader){j.find("thead").remove()}if(!i.showPageSummary){j.find("tfoot.kv-page-summary").remove()}if(!i.showFooter){j.find("tfoot.kv-table-footer").remove()}if(!i.showCaption){j.find("kv-table-caption").remove()}j.find(".skip-export").remove();j.find(".skip-export-"+k).remove();var l=j.html();l=i.preProcess(l);j.html(l);return j},preProcess:function(n){var k=this,o=k.exportConversions,j=o.length,q=n,p;if(j>0){for(var m=0;m<j;m++){p=o[m];q=a(q,p.from,p.to)}}return q},download:function(l,m){var j=this,i=j.$element.data("format"),k=h(j.config)?{}:j.config;j.$form.find('[name="export_filetype"]').val(l);j.$form.find('[name="export_filename"]').val(j.filename);j.$form.find('[name="export_content"]').val(m);j.$form.find('[name="export_mime"]').val(i);if(l==="pdf"){j.$form.find('[name="export_config"]').val(JSON.stringify(k))}else{j.$form.find('[name="export_config"]').val("")}if(j.target==="_popup"){j.popup=d("","kvDownloadDialog",350,120);j.popup.focus();j.setPopupAlert(j.messages.downloadProgress)}j.$form.submit()},exportHTML:function(){var j=this,k=j.clean("html"),i=j.config,m=(j.config.cssFile&&i.cssFile.length)?'<link href="'+j.config.cssFile+'" rel="stylesheet">':"",l=e.html.replace("{encoding}",j.encoding).replace("{css}",m).replace("{data}",f("<div />").html(k).html());j.download("html",l)},exportPDF:function(){var j=this,k=j.clean("pdf");var m=h(j.config.contentBefore)?"":j.config.contentBefore,n=h(j.config.contentAfter)?"":j.config.contentAfter,l=j.config.css,i=e.pdf.replace("{css}",l).replace("{before}",m).replace("{after}",n).replace("{data}",f("<div />").html(k).html());j.download("pdf",i)},exportTEXT:function(p){var q=this,o=q.clean(p),n=o.find("tr:has("+q.columns+")");var j=String.fromCharCode(11),l=String.fromCharCode(0);var m='"'+q.config.colDelimiter+'"',i='"'+q.config.rowDelimiter+'"';var k='"'+n.map(function(t,u){var r=f(u),s=r.find(q.columns);return s.map(function(w,v){var x=f(v),y=x.text().trim();return y.replace(/"/g,'""')}).get().join(j)}).get().join(l).split(l).join(i).split(j).join(m)+'"';q.download(p,k)},exportJSON:function(){var i=this,j=i.getArray("json");j=JSON.stringify(j,i.config.jsonReplacer,i.config.indentSpace);i.download("json",j)},exportEXCEL:function(){var j=this,k=j.clean("xls"),i=j.config,m,n,l=(i.cssFile&&j.config.cssFile.length)?'<link href="'+j.config.cssFile+'" rel="stylesheet">':"";k.find("td[data-raw-value]").each(function(){n=f(this);if(n.css("mso-number-format")||n.css("mso-number-format")===0||n.css("mso-number-format")==="0"){n.html(n.attr("data-raw-value")).removeAttr("data-raw-value")}});m=e.excel.replace("{encoding}",j.encoding).replace("{css}",l).replace("{worksheet}",j.config.worksheet).replace("{data}",f("<div />").html(k).html()).replace(/"/g,"'");j.download("xls",m)}};f.fn.gridexport=function(j){var i=Array.apply(null,arguments);i.shift();return this.each(function(){var m=f(this),l=m.data("gridexport"),k=typeof j==="object"&&j;if(!l){m.data("gridexport",(l=new g(this,f.extend({},f.fn.gridexport.defaults,k,f(this).data()))))}if(typeof j==="string"){l[j].apply(l,i)}})};f.fn.gridexport.defaults={};f.fn.gridexport.Constructor=g})(window.jQuery);