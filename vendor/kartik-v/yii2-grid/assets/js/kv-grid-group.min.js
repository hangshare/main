/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version   3.1.0
 *
 * Grid grouping jquery library created for yii2-grid.
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
var kvGridGroup;(function(a){kvGridGroup=function(o){var d,y,w,c,u,p,m,b,f,r,k,l,h,e,g,s,t,x,j,q,v;d=a("#"+o);y={};w=[];m=0;b=d.find("tr.kv-page-summary");f=d.find("tr[data-key]:first");r=d.find("tr[data-key]:last");k=function(i){return i===undefined||i===null||i.length===0};l=function(){var n=0;if(!b.length){return}b.find("td").each(function(){a(this).attr("data-col-seq",n);n++})};h=function(D,A,F,C){D=(D+"").replace(/[^0-9+\-Ee.]/g,"");var z=!isFinite(+D)?0:+D,G,i=!isFinite(+A)?0:Math.abs(A),H=(typeof C==="undefined")?",":C,B=(typeof F==="undefined")?".":F,E=function(K,J){var I=Math.pow(10,J);return""+Math.round(K*I)/I};G=(i?E(z,i):""+Math.round(z)).split(".");if(G[0].length>3){G[0]=G[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,H)}if((G[1]||"").length<i){G[1]=G[1]||"";G[1]+=[(i-G[1].length+1)].join("0")}return G.join(B)};e=function(n,A,F,z,E){var B,H,G,D,C;if(A.format==="number"){B=A.decimals||0;H=A.decPoint||".";G=A.thousandSep||",";return h(n,B,H,G)}if(A.format==="callback"){C=window[A.func];if(typeof C==="function"){D=t(F,z,E);return C(n,D)}}return n};g=function(B){var A,C,D=B.attr("data-sub-group-of"),z,n;if(k(D)){return null}n='td[data-col-seq="'+D+'"]';A=B.closest("tr");C=A.find(n);z=C.length;if(z>0){return C}while(z===0&&A.length){A=A.prev();C=A.find(n);z=C.length}return z===0?null:C};s=function(C,B){var z=C.attr("data-group-key"),n=0,A=B;if(B.attr("data-last-row")){return B}while(n===0&&A.length){A=B;B=B.next();n=B.find('td[data-group-key="'+z+'"]').length}return A.length?A:r};t=function(B,F,A){var z=1,D=[],n=B,C=n.hasClass("kv-grid-group-row"),E=F.attr("rowspan")||1;if(C){z=false;n=n.next(":not(.kv-grid-group-row");while(!z&&n.length){n.find('td[data-col-seq="'+A+'"]').each(function(){var i=a(this).text().replace(/[\s,]+/g,"");i=parseFloat(i);D.push(i)});z=n.hasClass("kv-grid-group-row");n=n.next()}}else{while(z<=E&&n.length){n.find('td[data-col-seq="'+A+'"]').each(function(){var i=a(this).text().replace(/[\s,]+/g,"");i=parseFloat(i);D.push(i)});n=n.next();z++}}return D};x=function(E,C,F,A){var B,D,z=0,G;switch(E){case"f_count":case"f_sum":case"f_avg":case"f_max":case"f_min":D=t(C,F,A);switch(E){case"f_count":return D.length;case"f_sum":case"f_avg":a.each(D,function(i,n){z+=n});if(E==="f_sum"){return z}G=D.length;return G?z/G:z;case"f_max":case"f_min":B=E.replace("f_","");return Math[B].apply(null,D)}return null;default:return E}};j=function(i,A){A=A||1;var z=i.attr("rowspan")||1;z=parseInt(z)+A;i.attr("rowspan",z)};q=function(){var n,z=[];r.nextAll("tr.kv-group-footer").each(function(){z.push(a(this))});if(z.length){for(n=0;n<z.length;n++){r.after(z[n])}}if(b.length){b.find("td").each(function(){var i=a(this);if(!f.find('td[data-col-seq="'+i.attr("data-col-seq")+'"]').length){i.remove()}})}};v=function(K,J){var D=K.data(J),C,M,G,n,E,B,I,L,z,H,A=false,F=(J==="groupHeader")?"kv-group-header":"kv-group-footer";if(!D){return}M=K.attr("data-group-key");G=K.closest("tr");if(M){G.attr("data-group-key",M)}C=K.attr("data-sub-group-of")?g(K):null;A=C&&C.length&&C.is("[data-grouped-row]");M=C&&C.length?C.attr("data-col-seq"):null;I=a(document.createElement("tr"));if(D.options){I.attr(D.options).addClass(F)}f.find("td").each(function(){n=a(this);E=n.attr("data-col-seq");if(!M||E!=M||A){L=a(document.createElement("td")).attr("data-summary-col-seq",E);if(D.content&&D.content[E]){H=x(D.content[E],G,K,E);if(D.contentFormats&&D.contentFormats[E]){H=e(H,D.contentFormats[E],G,K,E)}L.html(H)}if(D.contentOptions&&D.contentOptions[E]){L.attr(D.contentOptions[E])}L.appendTo(I)}});if(C&&C.length&&!A){j(C)}if(J==="groupHeader"){G.before(I);if(G.find('td[data-col-seq="'+M+'"]').length){I.find("td").each(function(){var N=a(this),i=parseInt(N.attr("data-summary-col-seq"));M=parseInt(M);if(i===M-1){N.after(C);return}if(i===M+1){N.before(C);return}if(i>M){N.before(C)}})}}else{z=s(K,G);if(A&&z.hasClass("kv-grid-group-row")){z.before(I)}else{z.after(I)}}if(D.mergeColumns&&D.mergeColumns.length){a.each(D.mergeColumns,function(O,Q){var S=Q[0],R=Q[1],P=0,N="";if(!(S>-1&&R>-1)){return}I.find("td").each(function(){var i=a(this);B=i.attr("data-summary-col-seq");if(B>=S&&B<=R){N+=i.html();P++}});I.find("td").each(function(){var i=a(this);B=i.attr("data-summary-col-seq");if(B>S&&B<=R){i.remove()}else{if(B==S){i.attr("colspan",P).html(N)}}})})}};l();d.find("td.kv-grid-group").each(function(){var n=a(this),i=a(this).attr("data-group-key");if(!i){return}if(a.inArray(i,w)<0){w.push(i)}if(y[i]===undefined){y[i]=[n]}else{y[i].push(n)}});a.each(w,function(D,G){var B=y[G],A=1,C=0,z,E,I="",n="",H="",F="";a.each(B,function(i,J){I=J.text().trim();z=B[C];if(D>0){E=g(J);if(E&&E.length){n=E.attr("data-cell-key")}F=n?n+"-"+I:I}else{F=I}J.attr("data-cell-key",F);if(F==H){A++;z.attr("rowspan",A);J.addClass("kv-temp-cells").hide()}else{C=i;A=1}H=F})});d.find("td.kv-grid-group.kv-temp-cells").remove();a.each(w,function(z,A){var n=0;d.find('td[data-group-key="'+A+'"]').each(function(){var C=a(this),B,i=n%2>0?C.attr("data-odd-css"):C.attr("data-even-css");if(i){C.removeClass(i).addClass(i)}if(C.is("[data-grouped-row]")){B=a(document.createElement("tr")).addClass("kv-grid-group-row");C.closest("tr").before(B);C.removeAttr("rowspan").appendTo(B).css("width","auto")}n++})});c=d.find("tr.kv-grid-group-row");if(c.length){m=d.find("tr[data-key]:first > td").length;if(m){c.each(function(){a(this).find(">td").attr("colspan",m)})}c.find("td[data-group-key]").each(function(){var n=a(this).data("groupKey"),i=d.find(".kv-grid-group-header[data-group-key]"),z=d.find(".kv-grid-group-filter[data-group-key]");a(this).closest("tr").data("groupKey",n);if(i.length){d.find('.kv-grid-group-header[data-group-key="'+n+'"]').remove()}if(z.length){d.find('.kv-grid-group-filter[data-group-key="'+n+'"]').remove()}})}r.attr("data-last-row",1);p=w.length-1;for(u=p;u>=0;u--){d.find('td[data-group-key="'+w[u]+'"]').each(function(){v(a(this),"groupFooter")})}for(u=0;u<=p;u++){d.find('td[data-group-key="'+w[u]+'"]').each(function(){v(a(this),"groupHeader")})}q()}})(window.jQuery);